# root
PROJECT(vangers)

CMAKE_MINIMUM_REQUIRED(VERSION 3.1.0)

# modules
SET(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)

# options
OPTION(RUSSIAN_VERSION "Build russian version" ON)
OPTION(BINARY_SCRIPT "Use binary script for interface" ON)
OPTION(WITH_OPENGL "Use experimental OpenGL renderer" OFF)
OPTION(DIAGEN_TEST "Dialog generator and test subsystem" OFF)

# hide optons
OPTION(ACTINT "Actint user interface in road game" ON) 

SET(CMAKE_CONFIGURATION_TYPES "Release;Debug;MinSizeRel;RelWithDebInfo")
IF(MINGW)
		SET(CMAKE_FIND_LIBRARY_SUFFIXES ".dll")
ENDIF()

set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# depends
FIND_PACKAGE(SDL2 REQUIRED)
FIND_PACKAGE(SDL2_net REQUIRED)
FIND_PACKAGE(SDL2_image REQUIRED)
FIND_PACKAGE(Ogg REQUIRED)
FIND_PACKAGE(Vorbis REQUIRED)
FIND_PACKAGE(VorbisFile REQUIRED)
FIND_PACKAGE(GLEW REQUIRED)
find_package(GLM REQUIRED)

if (EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/clunk")
	message(STATUS "Linking with Clunk submodule")
	set(CLUNK_SUBMODULE ON)
	set(BUILD_SHARED_LIBS OFF CACHE BOOL INTERNAL FORCE)
	add_subdirectory("clunk")
	set(BUILD_SHARED_LIBS ON CACHE BOOL INTERNAL FORCE)
else ()
	message(STATUS "Linking with Clunk package")
	FIND_PACKAGE(Clunk REQUIRED)
endif ()

FIND_PACKAGE(FFMPEG REQUIRED)
FIND_PACKAGE(ZLIB REQUIRED)
set(WINDOWS_RES "../vangers.res")

IF(RUSSIAN_VERSION)
	ADD_DEFINITIONS(-DRUSSIAN_VERSION)
ENDIF(RUSSIAN_VERSION)
IF(BINARY_SCRIPT)
	ADD_DEFINITIONS(-D_BINARY_SCRIPT_)
ENDIF(BINARY_SCRIPT)

FIND_PACKAGE(OpenGL REQUIRED)

IF(ACTINT)
	ADD_DEFINITIONS(-DACTINT)
ENDIF(ACTINT)

IF(DIAGEN_TEST)
	ADD_DEFINITIONS(-DDIAGEN_TEST)
ENDIF(DIAGEN_TEST)

# globals
INCLUDE_DIRECTORIES(SYSTEM
    ${CMAKE_INSTALL_PREFIX}/include
	${ZLIB_INCLUDE_DIR}
	${SDL2_INCLUDE_DIR}
	${SDL2_NET_INCLUDE_DIR}
	${SDL2_IMAGE_INCLUDE_DIR}
	${FFMPEG_INCLUDE_DIRS}
	${CLUNK_INCLUDE_DIR}
	${OGG_INCLUDE_DIR}
	${VORBIS_INCLUDE_DIR}
	${VORBISFILE_INCLUDE_DIR}
	${GLEW_INCLUDE_DIR}
	${GLM_INCLUDE_DIR}
)

SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wextra -Wno-unused-parameter -msse2")
# For modern gcc
add_definitions(-D_USE_MATH_DEFINES)

IF (NOT MINGW)
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -ftree-vectorize -ffast-math")
ENDIF (NOT MINGW)

# subdirs
ADD_SUBDIRECTORY("src")
ADD_SUBDIRECTORY("lib/xgraph")
ADD_SUBDIRECTORY("lib/xsound")
ADD_SUBDIRECTORY("lib/xtool")
ADD_SUBDIRECTORY("lib/utils")
ADD_SUBDIRECTORY("lib/vgl")
